<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate metric values — metric.values • BioMonTools</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate metric values — metric.values" />
<meta property="og:description" content="This function calculates metric values for bugs and fish.
Inputs are a data frame with SampleID and taxa with phylogenetic and autecological information
(see below for required fields by community).  The dplyr package is used to generate the metric values." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BioMonTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/vignette_BioMonTools.html">Vignette, BioMonTools</a>
    </li>
    <li>
      <a href="../articles/vignette_MapTaxaObs.html">Vignette, Taxa Maps</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/leppott/BioMonTools">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate metric values</h1>
    <small class="dont-index">Source: <a href='https://github.com/leppott/BioMonTools/blob/master/R/metric.values.R'><code>R/metric.values.R</code></a></small>
    <div class="hidden name"><code>metric.values.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function calculates metric values for bugs and fish.
Inputs are a data frame with SampleID and taxa with phylogenetic and autecological information
(see below for required fields by community).  The dplyr package is used to generate the metric values.</p>
    </div>

    <pre class="usage"><span class='fu'>metric.values</span>(<span class='no'>fun.DF</span>, <span class='no'>fun.Community</span>, <span class='kw'>fun.MetricNames</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>boo.Adjust</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>fun.cols2keep</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>boo.marine</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>fun.DF</th>
      <td><p>Data frame of taxa (list required fields)</p></td>
    </tr>
    <tr>
      <th>fun.Community</th>
      <td><p>Community name for which to calculate metric values (bugs, fish, or algae)</p></td>
    </tr>
    <tr>
      <th>fun.MetricNames</th>
      <td><p>Optional vector of metric names to be returned.
If none are supplied then all will be returned.  Default=NULL</p></td>
    </tr>
    <tr>
      <th>boo.Adjust</th>
      <td><p>Optional boolean value on whether to perform adjustments of
values prior to scoring.  Default = FALSE but may be TRUE for certain metrics.</p></td>
    </tr>
    <tr>
      <th>fun.cols2keep</th>
      <td><p>Column names of fun.DF to retain in the output.  Uses column names.</p></td>
    </tr>
    <tr>
      <th>boo.marine</th>
      <td><p>Should estuary/marine metrics be included.
Ignored if fun.MetricNames is not null. Default = FALSE.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>data frame of SampleID and metric values</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>All percent metric results are 0-100.</p>
<p>No manipulations of the taxa are performed by this routine.
All benthic macroinvertebrate taxa should be identified to the appropriate
operational taxonomic unit (OTU).</p>
<p>Any non-count taxa should be identified in the "Exclude" field as "TRUE".
These taxa will be excluded from taxa richness metrics (but will count for
all others).  #' Any non-target taxa should be identified in the "NonTarget"
field as "TRUE".  Non-target taxa are those that are not part of your intended
capture list; e.g., fish,  herps, water column taxa, or water surface taxa in
a benthic sample.  The target list will vary by program.  The non-target taxa
will be removed prior to any calculations.</p>
<p>Excluded taxa are ambiguous taxa (on a sample basis), i.e.,
the parent taxa when child taxa are present.  For example, the parent taxa
Chironomidae would be xcluded when the child taxa Tanytarsini is present.
Both would be excluded when Tanytarsus is present.  The markExcluded function
can be used to populated this field.</p>
<p>There are a number of required fields (see below) for metric to calculation.
If any fields are missing the user will be prompted as to which are missing
and if the user wants to continue or quit.  If the user continues the missing
fields will be added but will be filled with zero or NA (as appropriate).
Any metrics based on the missing fields will not be valid.</p>
<p>A future update may turn these fields into function parameters.  This would
allow the user to tweak the function inputs to match their data rather than
having to update their data to match the function.</p>
<p>Required Fields:</p>
<p>* SAMPLEID (character or number, must be unique)</p>
<p>* TAXAID (character or number, must be unique)</p>
<p>* N_TAXA</p>
<p>* EXCLUDE (valid values are TRUE and FALSE)</p>
<p>* INDEX_NAME</p>
<p>* INDEX_REGION (BCG or MMI site category; e.g., for BCG PacNW valid values are "hi" or "lo")</p>
<p>* NONTARGET (valid values are TRUE and FALSE)</p>
<p>* PHYLUM, SUBPHYLUM, CLASS, INFRAORDER, ORDER, FAMILY, SUBFAMILY, TRIBE, GENUS</p>
<p>* FFG, HABIT, LIFE_CYCLE, TOLVAL, BCG_ATTR, THERMAL_INDICATOR, FFG2, TOLVAL2</p>
<p>Valid values for FFG: CG, CF, PR, SC, SH</p>
<p>Valid values for HABIT: BU, CB, CN, SP, SW</p>
<p>Valid values for LIFE_CYCLE: UNI, SEMI, MULTI</p>
<p>Valid values for THERMAL_INDICATOR: COLD, COLD_COOL, COOL_WARM, WARM</p>
<p>Columns to keep are additional fields in the input file that the user wants
retained in the output.  Fields need to be those that are unique per sample
and not associated with the taxa.  For example, the fields used in qc.check();
Area_mi2, SurfaceArea, Density_m2, and Density_ft2.</p>
<p>If fun.MetricNames is provided only those metrics will be returned in the provided order.
This variable can be used to sort the metrics per the user's preferences..
By default the metric names will be returned in the groupings that were used for calculation.</p>
<p>The fields TOLVAL2 and FFG2 are provided to allow the user to calculate metrics
based on alternative scenarios.  For example, HBI and NCBI where the NCBI uses
a different set of tolerance values (TOLVAL2).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Example data</span>

<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>readxl</span>)
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>reshape2</span>)

<span class='no'>df_samps_bugs</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://readxl.tidyverse.org/reference/read_excel.html'>read_excel</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span>(<span class='st'>"extdata/Data_Benthos.xlsx"</span>
                                       , <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"BioMonTools"</span>)
                            , <span class='kw'>guess_max</span> <span class='kw'>=</span> <span class='fl'>10</span>^<span class='fl'>6</span>)

<span class='co'># Columns to keep</span>
<span class='no'>myCols</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"Area_mi2"</span>, <span class='st'>"SurfaceArea"</span>, <span class='st'>"Density_m2"</span>, <span class='st'>"Density_ft2"</span>)

<span class='co'># Run Function</span>
<span class='no'>df_metric_values_bugs</span> <span class='kw'>&lt;-</span> <span class='fu'>metric.values</span>(<span class='no'>df_samps_bugs</span>, <span class='st'>"bugs"</span>, <span class='kw'>fun.cols2keep</span><span class='kw'>=</span><span class='no'>myCols</span>)</div><div class='output co'>#&gt; <span class='error'>Error in !(names(met.val %in% MetricNames_Marine)): invalid argument type</span></div><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># View Results</span>
<span class='fu'><a href='https://rdrr.io/r/utils/View.html'>View</a></span>(<span class='no'>df_metric_values_bugs</span>)
}

<span class='co'># Get data in long format so can QC results more easily</span>
<span class='no'>df_long</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/reshape2/man/melt.html'>melt</a></span>(<span class='no'>df_metric_values_bugs</span>, <span class='kw'>id.vars</span><span class='kw'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"SAMPLEID"</span>, <span class='st'>"INDEX_NAME"</span>
                                                 , <span class='st'>"INDEX_REGION"</span>, <span class='fu'><a href='https://rdrr.io/r/base/chartr.html'>toupper</a></span>(<span class='no'>myCols</span>))
                          , <span class='kw'>variable.name</span><span class='kw'>=</span><span class='st'>"METRIC_NAME"</span>, <span class='kw'>value.name</span><span class='kw'>=</span><span class='st'>"METRIC_VALUE"</span>)</div><div class='output co'>#&gt; <span class='error'>Error in melt(df_metric_values_bugs, id.vars = c("SAMPLEID", "INDEX_NAME",     "INDEX_REGION", toupper(myCols)), variable.name = "METRIC_NAME",     value.name = "METRIC_VALUE"): object 'df_metric_values_bugs' not found</span></div><div class='input'>
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># Save Results</span>
<span class='fu'><a href='https://rdrr.io/r/utils/write.table.html'>write.table</a></span>(<span class='no'>df_long</span>, <span class='st'>"metric.values.tsv"</span>, <span class='kw'>col.names</span><span class='kw'>=</span><span class='fl'>TRUE</span>, <span class='kw'>row.names</span><span class='kw'>=</span><span class='fl'>FALSE</span>, <span class='kw'>sep</span><span class='kw'>=</span><span class='st'>"\t"</span>)

<span class='co'># DataExplorer Report</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>DataExplorer</span>)
<span class='fu'><a href='https://rdrr.io/pkg/DataExplorer/man/create_report.html'>create_report</a></span>(<span class='no'>df_metric_values_bugs</span>, <span class='st'>"DataExplorer_Report_MetricValues.html"</span>)
<span class='fu'><a href='https://rdrr.io/pkg/DataExplorer/man/create_report.html'>create_report</a></span>(<span class='no'>df_samps_bugs</span>, <span class='st'>"DataExplorer_Report_BugSamples.html"</span>)
}

<span class='co'>#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class='co'># Example 2, specific metrics or metrics in a specific order</span>
<span class='co'>## reuse df_samps_bugs from above</span>

<span class='co'># metric names to keep (in this order)</span>
<span class='no'>myMetrics</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"ni_total"</span>, <span class='st'>"nt_EPT"</span>, <span class='st'>"nt_Ephem"</span>, <span class='st'>"pi_tv_intol"</span>, <span class='st'>"pi_Ephem"</span>
               , <span class='st'>"nt_ffg_scrap"</span>, <span class='st'>"pi_habit_climb"</span>)

<span class='co'># Run Function</span>
<span class='no'>df_metric_values_bugs_myMetrics</span> <span class='kw'>&lt;-</span> <span class='fu'>metric.values</span>(<span class='no'>df_samps_bugs</span>, <span class='st'>"bugs"</span>
                                                , <span class='kw'>fun.MetricNames</span> <span class='kw'>=</span> <span class='no'>myMetrics</span>)
<span class='kw'>if</span> (<span class='fl'>FALSE</span>) {
<span class='co'># View Results</span>
<span class='fu'><a href='https://rdrr.io/r/utils/View.html'>View</a></span>(<span class='no'>df_metric_values_bugs_myMetrics</span>)
}</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Erik W. Leppo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


